name: Merchant Payment Reversal - sync - failure (identifier error)
slug: merchant-payment-reversal-sync-failure-identifier-error
use_case: Merchant Payment
behavior: negative
description: |
  Service Provider requests a reversal for a merchant payment through the Mobile Money API and the Mobile Money Provider handles the request and responds with an synchronous response. The reversal is unsuccessful and the error object is sent back to the service provider.
precondition: |
  - Mobile Money Operator has GSMA Mobile Money API Implemented.
  - Required Parameters for Execution:
    - transactionReference should be a valid value to reply the inform
  - Define the envrionment variables to customise this test case:
    - `TRANSACTION_REFERENCE`, default value is `99999911-2222-4e3d-8111-98211e4f910c`
    - `X_CLIENT_ID`, default value is `MERCHANT67890`
    - `CURRENCY`, default value is `USD`
components:
  -
    name: 'Service Provider'
    slug: sp
  -
    name: 'Mobile Money API Provider'
    slug: mmap
test_steps:
  -
    path: '/transactions/{transactionReference}/reversals'
    pattern: '^transactions/.*/reversals$'
    method: POST
    source: sp
    target: mmap
    api_spec: 'MM v1.2'
    test_request_scripts:
      -
        name: 'Header has the X-Client-Id'
        rules:
          headers.X-Client-Id: required
    test_response_scripts:
      -
        name: 'Error category is valid'
        rules:
          body.errorCategory: 'required|in:identification'
      -
        name: 'Error code is valid'
        rules:
          body.errorCode: 'required|in:identifierError'
      -
        name: 'Error status is correct'
        rules:
          status: 'required|in:404'
    request:
      method: POST
      uri: '/transactions/{{ env.TRANSACTION_REFERENCE|default("99999911-2222-4e3d-8111-98211e4f910c" )}}/reversals'
      headers:
        Accept: application/json
        X-Date: '{{ new_date_iso8601() }}'
        X-Client-Id: '{{ env.X_CLIENT_ID_MERCHANT|default("MERCHANT67890") }}'
        Content-Type: application/json
        X-CorrelationID: '{{ uuidv4() }}'
        X-ITP-transactionReference: '{{ env.TRANSACTION_REFERENCE|default("99999911-2222-4e3d-8111-98211e4f910c" )}}'
      body:
        type: reversal
    response:
      status: 404
      headers:
        X-Date: '{{ new_date_iso8601() }}'
        Content-Type: application/json
      body:
        errorCode: identifierError
        errorCategory: identification
