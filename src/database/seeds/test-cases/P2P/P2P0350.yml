name: P2P Declined - RD - Error 500
use_case: P2P
test_case: P2P0350
behavior: negative
description: |
  This testcase simulates a scenario where the Payer would like to send money to a Payee but each of them uses different providers and the Payer does not know Payee location.
  This flow shows the necessary steps for this transaction simulating an declined P2P transaction considering AmountType: Receive and Disclosing Fees.
precondition: |
  Mobile Money Operator is capable of handled async calls.
  Payee and Payer MMOs exist in Mojaloop as Participants.
  Payee and Payer exist in Mojaloop as Parties.
  Payer party should be identified by account identifier "msisdn" with the value "+33555123456".
  Payee party should be identified by account identifier "msisdn" with the value  "+33555789123".

test_steps:

## POST/Quotes: MMO1 -> Mojaloop ##
  - method: POST
    path: /quotes
    source: Mobile Money Operator 1
    target: Mojaloop
    api_scheme: Mojaloop v1.0

    test_request_scripts:
      - name: Transaction Type is a P2P transfer
        rules:
          body.type: 'in:TRANSFER'

    test_response_setups:
      - name: Override response
        values:
          status: 500
          body: {errorCode: "genericError", errorCategory: "businessRule", errorDateTime: "2020-05-12T14:17:59.843Z", errorDescription: "The specified property contents do not conform to the format required for this Property."}

    request:
      method: POST
      uri: /quotes
      headers:
        content-type: 'application/vnd.interoperability.quotes+json;version=1.0'
        date: 'Fri, 17 Apr 2020 10:28:45 GMT'
        fspiop-source: 'payerfsp'
        fspiop-destination: 'payeefsp'
      body:
        quoteId: 'ba2a764f-41d0-4b47-a774-dfe51012b04a'
        transactionId: 'ea1ae93f-d5b7-4f36-96c6-7fb164e1f23e'
        payee:
          partIdInfo:
            partyIdType: 'MSISDN'
            partyIdentifier: "+33555789123"
        payer:
          partIdInfo:
            partyIdType: 'MSISDN'
            partyIdentifier: "+33555123456"
          personalInfo:
            complexName:
              firstName: 'Lars'
              middleName: 'Per'
              lastName: 'Bergqvist'
            dateOfBirth: '1977-07-17'
        amountType: 'RECEIVE'
        amount:
          currency: 'USD'
          amount: '5.00'
        transactionType:
          scenario: 'TRANSFER'
          initiator: 'PAYER'
          initiatorType: 'CONSUMER'

    response:
      status: 500
      headers:
        content-type: 'application/json'
        x-date: '2020-04-07T10:28:44.466Z'
      body:
        errorCategory: 'businessRule'
        errorCode: 'genericError'
